rm(list=ls())
library(Iso)


fun1<-function(n11,n12,n13,n21,n22,n23,n31,n32,n33,v11,v12,v13,v21,v22,v23,v31,v32,v33)
{
  g11<-rnorm(n11,0,sqrt(v11));g12<-rnorm(n12,0,sqrt(v12));g13<-rnorm(n13,0,sqrt(v13))
  g21<-rnorm(n21,0,sqrt(v21));g22<-rnorm(n22,0,sqrt(v22));g23<-rnorm(n23,0,sqrt(v23))
  g31<-rnorm(n31,0,sqrt(v31));g32<-rnorm(n32,0,sqrt(v32));g33<-rnorm(n33,0,sqrt(v33))
  s11=var(g11);s12=var(g12);s13=var(g13)
  s21=var(g21);s22=var(g22);s23=var(g23)
  s31=var(g31);s32=var(g32);s33=var(g33)
  m11=mean(g11);m12=mean(g12);m13=mean(g13)
  m21=mean(g21);m22=mean(g22);m23=mean(g23)
  m31=mean(g31);m32=mean(g32);m33=mean(g33)
  m.1=(m11+m21+m31)/3;m.2=(m12+m22+m32)/3;m.3=(m13+m23+m33)/3
  m1.=(m11+m12+m13)/3;m2.=(m21+m22+m23)/3;m3.=(m31+m32+m33)/3
  m=(m11+m12+m13+m21+m22+m23+m31+m32+m33)/9
  A11=m11-m.1+m;A12=m12-m.2+m;A13=m13-m.3+m
  A21=m21-m.1+m;A22=m22-m.2+m;A23=m23-m.3+m
  A31=m31-m.1+m;A32=m32-m.2+m;A33=m33-m.3+m
  x12=c(A11,A21,A31);x13=c(A12,A22,A32);x14=c(A13,A23,A33);x15=c(m.1-m,m.2-m,m.3-m)
  S11=s11;S12=s12;S13=s13;S21=s21;S22=s22;S23=s23;S31=s31;S32=s32;S33=s33
  #sum((g11-x14[1]-x15[1])^2)/n11;S12=sum((g12-x14[1]-x15[2])^2)/n12
  #S21=sum((g21-x14[2]-x15[1])^2)/n21;S22=sum((g22-x14[2]-x15[2])^2)/n22
  repeat
  {
    u11=n11/S11;u12=n12/S12;u13=n13/S13;u21=n21/S21;u22=n22/S22;u23=n23/S23
    u31=n31/S31;u32=n32/S32;u33=n33/S33
    u.1=(u11+u21+u31);u.2=(u12+u22+u32);u.3=(u13+u23+u33)
    a1=c((m11-x15[1]),(m21-x15[1]),(m31-x15[1]))
    a2=c((m12-x15[2]),(m22-x15[2]),(m32-x15[2]))
    a3=c((m13-x15[3]),(m23-x15[3]),(m33-x15[3]))
    #a13=((u31*m31+u32*m32)+(u32-u31)*x15[1])/(u31+u32)
    w1=c(u11,u21,u31);w2=c(u12,u22,u32);w3=c(u13,u23,u33)
    #alpha0<-c(a10,a11,a13)
    #w=c(w1,w2,w3)
    nu1=pava(a1,w1);nu2=pava(a2,w2);nu3=pava(a3,w3)
    #nu=(nu1[1],nu2[1],nu1[2],nu2[2],nu1[3],nu2[3])
    q=(u13*(m13-nu3[1])+u23*(m23-nu3[2])+u33*(m33-nu3[3]))
    v1=(u11*(m11-nu1[1])+u21*(m21-nu1[2])+u31*(m31-nu1[3]))-q
    v2=(u12*(m12-nu2[1])+u22*(m22-nu2[2])+u32*(m32-nu2[3]))-q
    v=matrix(c(v1,v2),nrow=2,ncol=1,byrow=TRUE)
    A=matrix(c(u.1+u.3,u.3,u.3,u.2+u.3),nrow=2,ncol=2,byrow=TRUE)
    b=solve(A)%*%v
    b3=-(b[1]+b[2])
    beta=c(b[1],b[2],b3)
    S111=sum((g11-nu1[1]-b[1])^2)/n11;S112=sum((g12-nu2[1]-b[2])^2)/n12;S113=sum((g13-nu3[1]-b3)^2)/n13
    S121=sum((g21-nu1[2]-b[1])^2)/n21;S122=sum((g22-nu2[2]-b[2])^2)/n22;S123=sum((g23-nu3[2]-b3)^2)/n23
    S131=sum((g31-nu1[3]-b[1])^2)/n31;S132=sum((g32-nu2[3]-b[2])^2)/n32;S133=sum((g33-nu3[3]-b3)^2)/n33
    L=max(abs(x12-nu1));M=max(abs(x13-nu2));N=max(abs(x14-nu3));O=max(abs(x15-beta))
    if(L<=0.000001 & M<=0.0000001 & N<=0.0000001 & 0<=0.000001)
    {
      break
    }
    S11=S111;S12=S112;S13=S113;S21=S121;S22=S122;S23=S123;S31=S131;S32=S132;S33=S133
    x12=nu1;x13=nu2;x14=nu3;x15=beta
  }
  u11=n11/s11;u12=n12/s12;u13=n13/s13;u21=n21/s21;u22=n22/s22;u23=n23/s23
  u31=n31/s31;u32=n32/s32;u33=n33/s33
  U.1=u11+u21+u31;U.2=u12+u22+u32;U.3=u13+u23+u33
  beta01=c((u11*m11+u21*m21+u31*m31)/U.1,(u12*m12+u22*m22+u32*m32)/U.2,(u13*m13+u23*m23+u33*m33)/U.3)
  x16=beta01
  V11=sum((g11-x16[1])^2)/n11;V12=sum((g12-x16[2])^2)/n12;V13=sum((g13-x16[3])^2)/n13
  V21=sum((g21-x16[1])^2)/n21;V22=sum((g22-x16[2])^2)/n22;V23=sum((g23-x16[3])^2)/n23
  V31=sum((g31-x16[1])^2)/n31;V32=sum((g32-x16[2])^2)/n32;V33=sum((g33-x16[3])^2)/n33
  repeat
  {
    u11=n11/V11;u12=n12/V12;u13=n13/V13;u21=n21/V21;u22=n22/V22;u31=n31/V31;u32=n32/V32;u33=n33/V33
    U.1=u11+u21+u31;U.2=u12+u22+u32;U.3=u13+u23+u33
    beta11=c((u11*m11+u21*m21+u31*m31)/U.1,(u12*m12+u22*m22+u32*m32)/U.2,(u13*m13+u23*m23+u33*m33)/U.3)
    dif=max(abs(x16-beta11))
    if(dif<=0.00001)
    {
      break
    }
    S011=sum((g11-beta11[1])^2)/n11;S012=sum((g12-beta11[2])^2)/n12;S013=sum((g13-beta11[3])^2)/n13
    S021=sum((g21-beta11[1])^2)/n21;S022=sum((g22-beta11[2])^2)/n22;S023=sum((g23-beta11[3])^2)/n23
    S031=sum((g31-beta11[1])^2)/n31;S032=sum((g32-beta11[2])^2)/n32;S033=sum((g33-beta11[3])^2)/n33
    V11=S011;V12=S012;V13=S013;V21=S021;V22=S022;V23=S023;V31=S031;V32=S032;V33=S033
    x16=beta11
  }
  neu=(S111^(n11/2))*(S112^(n12/2))*(S113^(n13/2))*(S121^(n21/2))*(S122^(n22/2))*(S123^(n23/2))*
    (S131^(n31/2))*(S132^(n32/2))*(S133^(n33/2))
  dno=(V11^(n11/2))*(V12^(n12/2))*(V13^(n13/2))*(V21^(n21/2))*(V22^(n22/2))*(V23^(n23/2))*
    (V31^(n31/2))*(V32^(n32/2))*(V33^(n33/2))
  value=neu/dno
  return(value)
}
#X=replicate(10000,fun1(10,10,10,15,15,10,10,14,15,2,3,3.5,3,1.5,2,1,2,3))
#plot(X)

fun2<-function(n11,n12,n13,n21,n22,n23,n31,n32,n33,v11,v12,v13,v21,v22,v23,v31,v32,v33)
{
  x=replicate(1000,fun1(n11,n12,n13,n21,n22,n23,n31,n32,n33,v11,v12,v13,v21,v22,v23,v31,v32,v33))
  y<-sort(x,decreasing=FALSE)
  c<-y[50]
  return(c)
}

fun3<-function(n11,n12,n13,n21,n22,n23,n31,n32,n33,mu11,mu12,mu13,mu21,mu22,mu23,mu31,mu32,mu33,v11,v12,v13,v21,v22,v23,
               v31,v32,v33)
{
  g11<-rnorm(n11,mu11,sqrt(v11));g12<-rnorm(n12,mu12,sqrt(v12));g13<-rnorm(n13,mu13,sqrt(v13))
  g21<-rnorm(n21,mu21,sqrt(v21));g22<-rnorm(n22,mu22,sqrt(v22));g23<-rnorm(n23,mu23,sqrt(v23))
  g31<-rnorm(n31,mu31,sqrt(v31));g32<-rnorm(n32,mu32,sqrt(v32));g33<-rnorm(n33,mu33,sqrt(v33))
  #Y11=rt(n11,3,ncp=0)/sqrt(3);Y12=rt(n12,3,ncp=0)/sqrt(3);Y13=rt(n13,3,ncp=0)/sqrt(3)
  #Y21=rt(n21,3,ncp=0)/sqrt(3);Y22=rt(n22,3,ncp=0)/sqrt(3);Y23=rt(n23,3,ncp=0)/sqrt(3)
  #Y31=rt(n31,3,ncp=0)/sqrt(3);Y32=rt(n32,3,ncp=0)/sqrt(3);Y33=rt(n33,3,ncp=0)/sqrt(3)
  #g11=sqrt(v11)*Y11+mu11;g12=sqrt(v12)*Y12+mu12;g13=sqrt(v13)*Y13+mu13
  #g21=sqrt(v21)*Y21+mu21;g22=sqrt(v22)*Y22+mu22;g23=sqrt(v23)*Y23+mu23
  #g31=sqrt(v31)*Y31+mu31;g32=sqrt(v32)*Y32+mu32;g33=sqrt(v33)*Y33+mu33
  #Y11=rexp(n11,1);Y12=rexp(n12,1);Y13=rexp(n13,1);Y21=rexp(n21,1);Y22=rexp(n22,1);Y23=rexp(n23,1)
  #Y31=rexp(n31,1);Y32=rexp(n32,1);Y33=rexp(n33,1)
  #g11=mu11+sqrt(v11)*(Y11-1);g12=mu12+sqrt(v12)*(Y12-1);g13=mu13+sqrt(v13)*(Y13-1);g21=mu21+sqrt(v21)*(Y21-1)
  #g22=mu22+sqrt(v22)*(Y22-1);g23=mu23+sqrt(v23)*(Y23-1);g31=mu31+sqrt(v31)*(Y31-1);g32=mu32+sqrt(v32)*(Y32-1)
  #g33=mu33+sqrt(v33)*(Y33-1)
  #Y11=(rgamma(n11,2,1)-2)/sqrt(2);Y12=(rgamma(n12,2,1)-2)/sqrt(2);Y13=(rgamma(n13,2,1)-2)/sqrt(2);Y21=(rgamma(n21,2,1)-2)/sqrt(2)
  #Y22=(rgamma(n22,2,1)-2)/sqrt(2);Y23=(rgamma(n23,2,1)-2)/sqrt(2);Y31=(rgamma(n31,2,1)-2)/sqrt(2);Y32=(rgamma(n32,2,1)-2)/sqrt(2)
  #Y33=(rgamma(n33,2,1)-2)/sqrt(2)
  #g11=mu11+sqrt(v11)*Y11;g12=mu12+sqrt(v12)*Y12;g13=mu13+sqrt(v13)*Y13;g21=mu21+sqrt(v21)*Y21;g22=mu22+sqrt(v22)*Y22
  #g23=mu23+sqrt(v23)*Y23;g31=mu31+sqrt(v31)*Y31;g32=mu32+sqrt(v32)*Y32;g33=mu33+sqrt(v33)*Y33
  #Y11=(rlnorm(n11,0,1)-exp(.5))/sqrt(exp(2)-exp(1));Y12=(rlnorm(n12,0,1)-exp(.5))/sqrt(exp(2)-exp(1))
  #Y13=(rlnorm(n13,0,1)-exp(.5))/sqrt(exp(2)-exp(1))
  #Y21=(rlnorm(n21,0,1)-exp(.5))/sqrt(exp(2)-exp(1));Y22=(rlnorm(n22,0,1)-exp(.5))/sqrt(exp(2)-exp(1))
  #Y23=(rlnorm(n23,0,1)-exp(.5))/sqrt(exp(2)-exp(1))
  #Y31=(rlnorm(n31,0,1)-exp(.5))/sqrt(exp(2)-exp(1));Y32=(rlnorm(n32,0,1)-exp(.5))/sqrt(exp(2)-exp(1))
  #Y33=(rlnorm(n33,0,1)-exp(.5))/sqrt(exp(2)-exp(1))
  #g11=mu11+sqrt(v11)*Y11;g12=mu12+sqrt(v12)*Y12;g13=mu13+sqrt(v13)*Y13
  #g21=mu21+sqrt(v21)*Y21;g22=mu22+sqrt(v22)*Y22;g23=mu23+sqrt(v23)*Y23
  #g31=mu31+sqrt(v31)*Y31;g32=mu32+sqrt(v32)*Y32;g33=mu33+sqrt(v33)*Y33
  #g11=rdoublex(n11,mu11,sqrt(v11)/sqrt(2));g12=rdoublex(n12,mu12,sqrt(v12)/sqrt(2))
  #g13=rdoublex(n13,mu13,sqrt(v13)/sqrt(2))
  #g21=rdoublex(n21,mu21,sqrt(v21)/sqrt(2));g22=rdoublex(n22,mu22,sqrt(v22)/sqrt(2))
  #g23=rdoublex(n23,mu23,sqrt(v23)/sqrt(2))
  #g31=rdoublex(n31,mu31,sqrt(v31)/sqrt(2));g32=rdoublex(n32,mu32,sqrt(v32)/sqrt(2))
  #g33=rdoublex(n33,mu33,sqrt(v33)/sqrt(2))
  
  #Y11=(rweibull(n11,2,1)-sqrt(pi)/2)/sqrt(1-pi/4);Y12=(rweibull(n12,2,1)-sqrt(pi)/2)/sqrt(1-pi/4)
  #Y13=(rweibull(n13,2,1)-sqrt(pi)/2)/sqrt(1-pi/4)
  #Y21=(rweibull(n21,2,1)-sqrt(pi)/2)/sqrt(1-pi/4);Y22=(rweibull(n22,2,1)-sqrt(pi)/2)/sqrt(1-pi/4)
  #Y23=(rweibull(n23,2,1)-sqrt(pi)/2)/sqrt(1-pi/4)
  #Y31=(rweibull(n31,2,1)-sqrt(pi)/2)/sqrt(1-pi/4);Y32=(rweibull(n32,2,1)-sqrt(pi)/2)/sqrt(1-pi/4)
  #Y33=(rweibull(n33,2,1)-sqrt(pi)/2)/sqrt(1-pi/4)
  #g11=mu11+sqrt(v11)*Y11;g12=mu12+sqrt(v12)*Y12;g13=mu13+sqrt(v13)*Y13
  #g21=mu21+sqrt(v21)*Y21;g22=mu22+sqrt(v22)*Y22;g23=mu23+sqrt(v23)*Y23
  #g31=mu31+sqrt(v31)*Y31;g32=mu32+sqrt(v32)*Y32;g33=mu33+sqrt(v33)*Y33
  
  
  s11=var(g11);s12=var(g12);s13=var(g13)
  s21=var(g21);s22=var(g22);s23=var(g23)
  s31=var(g31);s32=var(g32);s33=var(g33)
  m11=mean(g11);m12=mean(g12);m13=mean(g13)
  m21=mean(g21);m22=mean(g22);m23=mean(g23)
  m31=mean(g31);m32=mean(g32);m33=mean(g33)
  m.1=(m11+m21+m31)/3;m.2=(m12+m22+m32)/3;m.3=(m13+m23+m33)/3
  m1.=(m11+m12+m13)/3;m2.=(m21+m22+m23)/3;m3.=(m31+m32+m33)/3
  m=(m11+m12+m13+m21+m22+m23+m31+m32+m33)/9
  A11=m11-m.1+m;A12=m12-m.2+m;A13=m13-m.3+m
  A21=m21-m.1+m;A22=m22-m.2+m;A23=m23-m.3+m
  A31=m31-m.1+m;A32=m32-m.2+m;A33=m33-m.3+m
  x12=c(A11,A21,A31);x13=c(A12,A22,A32);x14=c(A13,A23,A33);x15=c(m.1-m,m.2-m,m.3-m)
  S11=s11;S12=s12;S13=s13;S21=s21;S22=s22;S23=s23;S31=s31;S32=s32;S33=s33
  #sum((g11-x14[1]-x15[1])^2)/n11;S12=sum((g12-x14[1]-x15[2])^2)/n12
  #S21=sum((g21-x14[2]-x15[1])^2)/n21;S22=sum((g22-x14[2]-x15[2])^2)/n22
  repeat
  {
    u11=n11/S11;u12=n12/S12;u13=n13/S13;u21=n21/S21;u22=n22/S22;u23=n23/S23
    u31=n31/S31;u32=n32/S32;u33=n33/S33
    u.1=(u11+u21+u31);u.2=(u12+u22+u32);u.3=(u13+u23+u33)
    a1=c((m11-x15[1]),(m21-x15[1]),(m31-x15[1]))
    a2=c((m12-x15[2]),(m22-x15[2]),(m32-x15[2]))
    a3=c((m13-x15[3]),(m23-x15[3]),(m33-x15[3]))
    #a13=((u31*m31+u32*m32)+(u32-u31)*x15[1])/(u31+u32)
    w1=c(u11,u21,u31);w2=c(u12,u22,u32);w3=c(u13,u23,u33)
    #alpha0<-c(a10,a11,a13)
    #w=c(w1,w2,w3)
    nu1=pava(a1,w1);nu2=pava(a2,w2);nu3=pava(a3,w3)
    #nu=(nu1[1],nu2[1],nu1[2],nu2[2],nu1[3],nu2[3])
    q=(u13*(m13-nu3[1])+u23*(m23-nu3[2])+u33*(m33-nu3[3]))
    v1=(u11*(m11-nu1[1])+u21*(m21-nu1[2])+u31*(m31-nu1[3]))-q
    v2=(u12*(m12-nu2[1])+u22*(m22-nu2[2])+u32*(m32-nu2[3]))-q
    v=matrix(c(v1,v2),nrow=2,ncol=1,byrow=TRUE)
    A=matrix(c(u.1+u.3,u.3,u.3,u.2+u.3),nrow=2,ncol=2,byrow=TRUE)
    b=solve(A)%*%v
    b3=-(b[1]+b[2])
    beta=c(b[1],b[2],b3)
    S111=sum((g11-nu1[1]-b[1])^2)/n11;S112=sum((g12-nu2[1]-b[2])^2)/n12;S113=sum((g13-nu3[1]-b3)^2)/n13
    S121=sum((g21-nu1[2]-b[1])^2)/n21;S122=sum((g22-nu2[2]-b[2])^2)/n22;S123=sum((g23-nu3[2]-b3)^2)/n23
    S131=sum((g31-nu1[3]-b[1])^2)/n31;S132=sum((g32-nu2[3]-b[2])^2)/n32;S133=sum((g33-nu3[3]-b3)^2)/n33
    L=max(abs(x12-nu1));M=max(abs(x13-nu2));N=max(abs(x14-nu3));O=max(abs(x15-beta))
    if(L<=0.000001 & M<=0.0000001 & N<=0.0000001 & 0<=0.000001)
    {
      break
    }
    S11=S111;S12=S112;S13=S113;S21=S121;S22=S122;S23=S123;S31=S131;S32=S132;S33=S133
    x12=nu1;x13=nu2;x14=nu3;x15=beta
  }
  u11=n11/s11;u12=n12/s12;u13=n13/s13;u21=n21/s21;u22=n22/s22;u23=n23/s23
  u31=n31/s31;u32=n32/s32;u33=n33/s33
  U.1=u11+u21+u31;U.2=u12+u22+u32;U.3=u13+u23+u33
  beta01=c((u11*m11+u21*m21+u31*m31)/U.1,(u12*m12+u22*m22+u32*m32)/U.2,(u13*m13+u23*m23+u33*m33)/U.3)
  x16=beta01
  V11=sum((g11-x16[1])^2)/n11;V12=sum((g12-x16[2])^2)/n12;V13=sum((g13-x16[3])^2)/n13
  V21=sum((g21-x16[1])^2)/n21;V22=sum((g22-x16[2])^2)/n22;V23=sum((g23-x16[3])^2)/n23
  V31=sum((g31-x16[1])^2)/n31;V32=sum((g32-x16[2])^2)/n32;V33=sum((g33-x16[3])^2)/n33
  repeat
  {
    u11=n11/V11;u12=n12/V12;u13=n13/V13;u21=n21/V21;u22=n22/V22;u31=n31/V31;u32=n32/V32;u33=n33/V33
    U.1=u11+u21+u31;U.2=u12+u22+u32;U.3=u13+u23+u33
    beta11=c((u11*m11+u21*m21+u31*m31)/U.1,(u12*m12+u22*m22+u32*m32)/U.2,(u13*m13+u23*m23+u33*m33)/U.3)
    dif=max(abs(x16-beta11))
    if(dif<=0.00001)
    {
      break
    }
    S011=sum((g11-beta11[1])^2)/n11;S012=sum((g12-beta11[2])^2)/n12;S013=sum((g13-beta11[3])^2)/n13
    S021=sum((g21-beta11[1])^2)/n21;S022=sum((g22-beta11[2])^2)/n22;S023=sum((g23-beta11[3])^2)/n23
    S031=sum((g31-beta11[1])^2)/n31;S032=sum((g32-beta11[2])^2)/n32;S033=sum((g33-beta11[3])^2)/n33
    V11=S011;V12=S012;V13=S013;V21=S021;V22=S022;V23=S023;V31=S031;V32=S032;V33=S033
    x16=beta11
  }
  neu=(S111^(n11/2))*(S112^(n12/2))*(S113^(n13/2))*(S121^(n21/2))*(S122^(n22/2))*(S123^(n23/2))*
    (S131^(n31/2))*(S132^(n32/2))*(S133^(n33/2))
  dno=(V11^(n11/2))*(V12^(n12/2))*(V13^(n13/2))*(V21^(n21/2))*(V22^(n22/2))*(V23^(n23/2))*
    (V31^(n31/2))*(V32^(n32/2))*(V33^(n33/2))
  value=neu/dno
  #return(value)
  out<-fun2(n11,n12,n13,n21,n22,n23,n31,n32,n33,s11,s12,s13,s21,s22,s23,s31,s32,s33)
  a=0
  if(value<out)
   a=a+1
  return(a)
}
#X=replicate(10000,fun3(10,10,10,15,15,10,10,20,14,0.2,0.3,0.2,0.3,0.2,0.3,0.1,0.2,0.3,1,1,1.5,1,1.5,2,1,1,1))
#plot(X)

fun4<-function(n11,n12,n13,n21,n22,n23,n31,n32,n33,mu11,mu12,mu13,
               mu21,mu22,mu23,mu31,mu32,mu33,v11,v12,v13,v21,v22,v23,v31,v32,v33)
{
  # find number of times LRT value < critical value among 1000 values
  out<-replicate(1000,fun3(n11,n12,n13,n21,n22,n23,n31,n32,n33,mu11,mu12,mu13,
                           mu21,mu22,mu23,mu31,mu32,mu33,v11,v12,v13,v21,v22,v23,v31,v32,v33))
  value<-mean(out)
  return(value)
}

X=replicate(5,fun4(20,20,20,15,15,15,20,20,20,0,0,0,0,0,0,0,0,0,
                   1,1,1,1,1,1,1,1,1))
X;mean(X)
X=replicate(5,fun4(20,20,20,15,15,15,20,20,20,0,0,0,0,0,0,0,0,0,
                   2,2,2,2,2,2,2,2,2))
X;mean(X)
X=replicate(5,fun4(20,20,20,15,15,15,20,20,20,0,0,0,0,0,0,0,0,0,
                   4,4,4,4,4,4,4,4,4))
X;mean(X)
X=replicate(5,fun4(20,20,20,15,15,15,20,20,20,0,0,0,0,0,0,0,0,0,
                   4,2,3,1,4,2,3,1,4))
X;mean(X)

X=replicate(5,fun4(25,30,25,30,25,30,25,30,25,0,0,0,0,0,0,0,0,0,
                   1,1,1,1,1,1,1,1,1))
X;mean(X)
X=replicate(5,fun4(25,30,25,30,25,30,25,30,25,0,0,0,0,0,0,0,0,0,
                   2,2,2,2,2,2,2,2,2))
X;mean(X)
X=replicate(5,fun4(25,30,25,30,25,30,25,30,25,0,0,0,0,0,0,0,0,0,
                   4,4,4,4,4,4,4,4,4))
X;mean(X)
X=replicate(5,fun4(25,30,25,30,25,30,25,30,25,0,0,0,0,0,0,0,0,0,
                   4,2,3,1,4,2,3,1,4))
X;mean(X)
X=replicate(5,fun4(30,35,40,30,35,40,30,35,40,0,0,0,0,0,0,0,0,0,
                   1,1,1,1,1,1,1,1,1))
X;mean(X)
X=replicate(5,fun4(30,35,40,30,35,40,30,35,40,0,0,0,0,0,0,0,0,0,
                   2,2,2,2,2,2,2,2,2))
X;mean(X)
X=replicate(5,fun4(30,35,40,30,35,40,30,35,40,0,0,0,0,0,0,0,0,0,
                   4,4,4,4,4,4,4,4,4))
X;mean(X)
X=replicate(5,fun4(30,35,40,30,35,40,30,35,40,0,0,0,0,0,0,0,0,0,
                   4,2,3,1,4,2,3,1,4))
X;mean(X)





X=replicate(5,fun4(8,8,4,4,6,6,15,15,10,0,0,0,0,0,0,0,0,0,
                   0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
X;mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1,-0.2,-0.1,0.05,0.1,-0.1,0.05,0.1,0.2,
                   0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*1.5,-0.2*1.5,-0.1*1.5,0.05*1.5,0.1*1.5,-0.1*1.5,
                   0.05*1.5,0.1*1.5,0.2*1.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*2,-0.2*2,-0.1*2,0.05*2,0.1*2,-0.1*2,
                   0.05*2,0.1*2,0.2*2,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*2.5,-0.2*2.5,-0.1*2.5,0.05*2.5,0.1*2.5,-0.1*2.5,
                   0.05*2.5,0.1*2.5,0.2*2.5, 0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*3,-0.2*3,-0.1*3,0.05*3,0.1*3,-0.1*3,
                   0.05*3,0.1*3,0.2*3,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*3.5,-0.2*3.5,-0.1*3.5,0.05*3.5,0.1*3.5,-0.1*3.5,
                   0.05*3.5,0.1*3.5,0.2*3.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*4,-0.2*4,-0.1*4,0.05*4,0.1*4,-0.1*4,
                   0.05*4,0.1*4,0.2*4,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*4.5,-0.2*4.5,-0.1*4.5,0.05*4.5,0.1*4.5,-0.1*4.5,
                   0.05*4.5,0.1*4.5,0.2*4.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*5,-0.2*5,-0.1*5,0.05*5,0.1*5,-0.1*5,
                   0.05*5,0.1*5,0.2*5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*5.5,-0.2*5.5,-0.1*5.5,0.05*5.5,0.1*5.5,-0.1*5.5,
                   0.05*5.5,0.1*5.5,0.2*5.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*6,-0.2*6,-0.1*6,0.05*6,0.1*6,-0.1*6,
                   0.05*6,0.1*6,0.2*6,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*6.5,-0.2*6.5,-0.1*6.5,0.05*6.5,0.1*6.5,-0.1*6.5,
                   0.05*6.5,0.1*6.5,0.2*6.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*7,-0.2*7,-0.1*7,0.05*7,0.1*7,-0.1*7,
                   0.05*7,0.1*7,0.2*7,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)


X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,0,0,0,0,0,0,0,0,0,
                   0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1,-0.2,-0.1,0.05,0.1,-0.1,0.05,0.1,0.2,
                   0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*1.5,-0.2*1.5,-0.1*1.5,0.05*1.5,0.1*1.5,-0.1*1.5,
                   0.05*1.5,0.1*1.5,0.2*1.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*2,-0.2*2,-0.1*2,0.05*2,0.1*2,-0.1*2,
                   0.05*2,0.1*2,0.2*2,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*2.5,-0.2*2.5,-0.1*2.5,0.05*2.5,0.1*2.5,-0.1*2.5,
                   0.05*2.5,0.1*2.5,0.2*2.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*3,-0.2*3,-0.1*3,0.05*3,0.1*3,-0.1*3,
                   0.05*3,0.1*3,0.2*3,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)
X=replicate(3,fun4(8,8,4,4,6,6,15,15,10,-0.1*3.5,-0.2*3.5,-0.1*3.5,0.05*3.5,0.1*3.5,-0.1*3.5,
                   0.05*3.5,0.1*3.5,0.2*3.5,0.3,0.3,0.7,0.7,0.9,0.9,0.5,0.5,1))
mean(X)





X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*4,0.1*4,0.5*4,0.2*4,0.2*4,0.6*4,0.3*4,
                   0.25*4,0.65*4,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*4.5,0.1*4.5,0.5*4.5,0.2*4.5,0.2*4.5,0.6*4.5,0.3*4.5,
                   0.25*4.5,0.65*4.5,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*5,0.1*5,0.5*5,0.2*5,0.2*5,0.6*5,0.3*5,
                   0.25*5,0.65*5,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)




X=replicate(5,fun4(10,10,10,15,15,15,20,20,20,0,0,0,0,0,0,0,0,0,
                   0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
X;mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1,0.1,0.5,0.2,0.2,0.6,0.3,0.25,0.65,
                   0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*1.5,0.1*1.5,0.5*1.5,0.2*1.5,0.2*1.5,0.6*1.4,0.3*1.5,
                   0.25*1.5,0.65*1.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*2,0.1*2,0.5*2,0.2*2,0.2*2,0.6*2,0.3*2,
                   0.25*2,0.65*2,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*2.5,0.1*2.5,0.5*2.5,0.2*2.5,0.2*2.5,0.6*2.5,0.3*2.5,
                   0.25*2.5,0.65*2.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*3,0.1*3,0.5*3,0.2*3,0.2*3,0.6*3,0.3*3,
                   0.25*3,0.65*3,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*3.5,0.1*3.5,0.5*3.5,0.2*3.5,0.2*3.5,0.6*3.5,0.3*3.5,
                   0.25*3.5,0.65*3.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*4,0.1*4,0.5*4,0.2*4,0.2*4,0.6*4,0.3*4,
                   0.25*4,0.65*4,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*4.5,0.1*4.5,0.5*4.5,0.2*4.5,0.2*4.5,0.6*4.5,0.3*4.5,
                   0.25*4.5,0.65*4.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*5,0.1*5,0.5*5,0.2*5,0.2*5,0.6*5,0.3*5,
                   0.25*5,0.65*5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*5.5,0.1*5.5,0.5*5.5,0.2*5.5,0.2*5.5,0.6*5.5,0.3*5.5,
                   0.25*5.5,0.65*5.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*6,0.1*6,0.5*6,0.2*6,0.2*6,0.6*6,0.3*6,
                   0.25*6,0.65*6,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*6.5,0.1*6.5,0.5*6.5,0.2*6.5,0.2*6.5,0.6*6.5,0.3*6.5,
                   0.25*6.5,0.65*6.5,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(10,10,10,15,15,15,20,20,20,0.1*7,0.1*7,0.5*7,0.2*7,0.2*7,0.6*7,0.3*7,
                   0.25*7,0.65*7,0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2,0.3))
mean(X)


X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*2.2,-0.03*2.2,-0.1*2.2,-0.01*2.2,-0.02*2.2,-0.05*2.2,0.03*2.2,0.05*2.2,0.15*2.2,
                   0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
X;mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*2.4,-0.03*2.4,-0.1*2.4,-0.01*2.4,-0.02*2.4,-0.05*2.4,
                   0.03*2.4,0.05*2.4,0.15*2.4,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*2.6,-0.03*2.6,-0.1*2.6,-0.01*2.6,-0.02*2.6,-0.05*2.6,
                   0.03*2.6,0.05*2.6,0.15*2.6,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*2.8,-0.03*2.8,-0.1*2.8,-0.01*2.8,-0.02*2.8,-0.05*2.8,
                   0.03*2.8,0.05*2.8,0.15*2.8,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*3,-0.03*3,-0.1*3,-0.01*3,-0.02*3,-0.05*3,
                   0.03*3,0.05*3,0.15*3,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*3.2,-0.03*3.2,-0.1*3.2,-0.01*3.2,-0.02*3.2,-0.05*3.2,
                   0.03*3.2,0.05*3.2,0.15*3.2,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*3.4,-0.03*3.4,-0.1*3.4,-0.01*3.4,-0.02*3.4,-0.05*3.4,
                   0.03*3.4,0.05*3.4,0.15*3.4,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*3.6,-0.03*3.6,-0.1*3.6,-0.01*3.6,-0.02*3.6,-0.05*3.6,
                   0.03*3.6,0.05*3.6,0.15*3.6,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*3.8,-0.03*3.8,-0.1*3.8,-0.01*3.8,-0.02*3.8,-0.05*3.8,
                   0.03*3.8,0.05*3.8,0.15*3.8,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*4,-0.03*4,-0.1*4,-0.01*4,-0.02*4,-0.05*4,
                   0.03*4,0.05*4,0.15*4,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*4.2,-0.03*4.2,-0.1*4.2,-0.01*4.2,-0.02*4.2,-0.05*4.2,
                   0.03*4.2,0.05*4.2,0.15*4.2,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*4.4,-0.03*4.4,-0.1*4.4,-0.01*4.4,-0.02*4.4,-0.05*4.4,
                   0.03*4.4,0.05*4.4,0.15*4.4,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*4.6,-0.03*4.6,-0.1*4.6,-0.01*4.6,-0.02*4.6,-0.05*4.6,
                   0.03*4.6,0.05*4.6,0.15*4.6,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*4.8,-0.03*4.8,-0.1*4.8,-0.01*4.8,-0.02*4.8,-0.05*4.8,
                   0.03*4.8,0.05*4.8,0.15*4.8,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
X=replicate(1,fun4(8,8,4,4,6,6,15,15,10,-0.02*5,-0.03*5,-0.1*5,-0.01*5,-0.02*5,-0.05*5,
                   0.03*5,0.05*5,0.15*5,0.1,0.2,0.3,0.1,0.2,0.2,0.1,0.2,0.3))
mean(X)
